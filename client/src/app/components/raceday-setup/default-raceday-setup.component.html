<div class="setup-container" [style.transform]="'translate(-50%, -50%) scale(' + scale + ')'"
  *ngIf="translationsLoaded">

  <!-- Menu Bar -->
  <div class="menu-bar">
    <div class="menu-item-wrapper" *ngFor="let item of menuItems"
      [class.options-menu-container]="item.label === 'RDS_MENU_OPTIONS'">
      <div class="menu-item" (click)="item.action($event)">{{ item.label | translate }}</div>

      <!-- Options Dropdown -->
      <div class="menu-dropdown" *ngIf="item.label === 'RDS_MENU_OPTIONS' && isOptionsDropdownOpen">
        <div class="menu-dropdown-item" (click)="configureCustomUI()">{{ 'RDS_MENU_CUSTOM_UI' | translate }}</div>
        <div class="menu-dropdown-item" (click)="revertCustomUI()">{{ 'RDS_MENU_REVERT_UI' | translate }}</div>
      </div>
    </div>
  </div>

  <!-- Main Header -->
  <div class="main-header">
    <div class="logo-text">Race Coordinator <span class="logo-highlight">AI</span></div>
  </div>

  <div class="content-area">

    <!-- Driver Selection Panel -->
    <div class="panel driver-panel">
      <div class="panel-header">
        {{ 'RDS_DRIVERS_AVAILABLE' | translate }}
        <span style="font-size: 12px; color: #888;">{{ 'RDS_SELECTED_COUNT' | translate:{count:
          selectedDrivers.length} }}</span>
      </div>

      <!-- Unified List Container -->
      <div class="driver-list-container" cdkScrollable>

        <!-- Drop Zone for Reordering -->
        <div class="drop-zone" id="selected-list" cdkDropList [cdkDropListData]="selectedDrivers"
          (cdkDropListDropped)="drop($event)">

          <!-- Selected Drivers (Draggable) -->
          <div *ngIf="selectedDrivers.length > 0" class="section-divider">{{ 'RDS_SECTION_RACING' | translate
            }}</div>

          <div *ngFor="let driver of selectedDrivers; let i = index" class="driver-item selected" cdkDrag
            (click)="toggleDriverSelection(driver, true)">
            <div class="checkbox">
              <div class="checkbox-icon">✓</div>
            </div>
            <div class="driver-seed">({{ i + 1 }})</div>
            <div class="driver-avatar">
              <!-- Placeholder Avatar -->
              <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                <path
                  d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
              </svg>
            </div>
            <div class="driver-details">
              <div class="driver-name">{{ driver.name }}</div>
              <div class="driver-meta">{{ driver.nickname }}</div>
            </div>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
            </svg>

            <!-- Drag Preview -->
            <div *cdkDragPreview class="driver-item selected" style="width: 380px;">
              <div class="checkbox">
                <div class="checkbox-icon">✓</div>
              </div>
              <div class="driver-avatar">
                <!-- Placeholder Avatar -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#ccc">
                  <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                </svg>
              </div>
              <div class="driver-details">
                <div class="driver-name">{{ driver.name }}</div>
                <div class="driver-meta">{{ driver.nickname }}</div>
              </div>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
              </svg>
            </div>
          </div>
        </div>

        <!-- Unselected Drivers (Static) -->
        <div *ngIf="filteredUnselectedDrivers.length > 0" class="section-divider">{{ 'RDS_SECTION_AVAILABLE' |
          translate }}</div>

        <div *ngFor="let driver of filteredUnselectedDrivers" class="driver-item"
          (click)="toggleDriverSelection(driver, false)">
          <div class="checkbox"></div>
          <div class="driver-details">
            <div class="driver-name">{{ driver.name }}</div>
            <div class="driver-meta">{{ driver.nickname }}</div>
          </div>
        </div>

      </div>

      <div class="search-bar">
        <div class="search-wrapper">
          <input type="text" class="search-input driver-search" [placeholder]="'RDS_FILTER_DRIVERS' | translate"
            [(ngModel)]="driverSearchQuery">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z" />
          </svg>
        </div>
      </div>
    </div>

    <!-- Race Configuration Panel -->
    <div class="panel race-panel">
      <div class="quick-start-grid">
        <div *ngFor="let race of quickStartRaces; let i = index" class="race-card"
          [class.active]="selectedRace?.entity_id === race.entity_id" [ngClass]="getRaceCardBackgroundClass(i)"
          (click)="selectRace(race)">
          <div class="card-content">
            <div class="card-title">{{ race.name }}</div>
            <div class="card-desc">Standard Configuration</div>
            <div class="card-btn">Select</div>
          </div>
        </div>
      </div>

      <div class="race-selection-title">{{ 'RDS_SECTION_ALL_RACES' | translate }}</div>
      <div class="all-races-selector">
        <div class="search-wrapper">
          <input type="text" class="search-input race-search" [placeholder]="'RDS_FILTER_RACES' | translate"
            [(ngModel)]="raceSearchQuery">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z" />
          </svg>
        </div>
        <div class="custom-dropdown-container">
          <div class="dropdown-trigger" (click)="toggleDropdown($event)">
            <span class="selected-value">{{ selectedRace?.name || 'Select a Race' }}</span>
            <div class="dropdown-arrow" [class.open]="isDropdownOpen">▼</div>
          </div>
          <div class="dropdown-menu" *ngIf="isDropdownOpen">
            <div class="dropdown-item" *ngFor="let race of filteredRaces" (click)="selectRace(race)"
              [class.selected]="selectedRace?.entity_id === race.entity_id">
              {{ race.name }}
            </div>
          </div>
        </div>
      </div>

      <div class="action-footer">
        <button class="btn-start" (click)="startRace(false)" [disabled]="selectedDrivers.length === 0">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z" />
          </svg>
          {{ 'RDS_BTN_START_RACE' | translate }}
        </button>
        <button class="btn-demo" (click)="startRace(true)" [disabled]="selectedDrivers.length === 0">
          <span>{{ 'RDS_BTN_DEMO_RACE' | translate }}</span>
        </button>
      </div>
    </div>

  </div>
</div>