<div class="rm-container" [style.transform]="'translate(-50%, -50%) scale(' + scale + ')'">
  <div class="rm-header">
    <app-back-button [label]="'RM_BTN_BACK' | translate"></app-back-button>
  </div>

  <div class="main-content">
    <!-- LEFT PANEL: RACES TABLE -->
    <div class="panel list-panel">
      <div class="panel-header">
        <div class="panel-title">{{ 'RM_HEADER_RACES' | translate }}</div>
        <div class="search-container">
          <input type="text" [placeholder]="'RM_PLACEHOLDER_SEARCH' | translate" [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchChange()" class="search-input">
        </div>
      </div>
      <div class="table-header-fixed">
        <table class="race-table header-only">
          <thead>
            <tr>
              <th class="col-name">{{ 'RM_COL_NAME' | translate }}</th>
              <th class="col-track">{{ 'RM_COL_TRACK' | translate }}</th>
              <th class="col-heat-rotation">{{ 'RM_COL_HEAT_ROTATION' | translate }}</th>
            </tr>
          </thead>
        </table>
      </div>
      <div class="table-body-scroll">
        <table class="race-table body-only">
          <tbody>
            <tr *ngFor="let race of filteredRaces; trackBy: trackByRace" #raceRow [attr.data-id]="race.entity_id"
              [class.active]="selectedRace?.entity_id === race.entity_id" (click)="selectRace(race)">
              <td class="name-cell col-name">{{ race.name }}</td>
              <td class="track-cell col-track">{{ race.track?.name || 'N/A' }}</td>
              <td class="heat-rotation-cell col-heat-rotation">{{ getHeatRotationTypeDisplay(race.heat_rotation_type) }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- RIGHT PANEL: CONFIGURATION -->
    <div class="panel config-panel">
      <div class="config-header">{{ 'RM_HEADER_CONFIG' | translate }}</div>

      <div class="config-form" *ngIf="editingRace">
        <div class="scrollable-content">
          <div class="form-row">
            <div class="form-group">
              <label>{{ 'RM_LABEL_NAME' | translate }}</label>
              <input type="text" [(ngModel)]="editingRace.name" class="rm-input" readonly>
            </div>

            <div class="form-group">
              <label>{{ 'RM_LABEL_TRACK' | translate }}</label>
              <input type="text" [ngModel]="editingRace.track?.name || 'N/A'" class="rm-input" readonly>
            </div>
          </div>

          <div class="form-group">
            <label>{{ 'RM_LABEL_HEAT_ROTATION' | translate }}</label>
            <input type="text" [ngModel]="getHeatRotationTypeDisplay(editingRace.heat_rotation_type)" class="rm-input"
              readonly>
          </div>

          <!-- Heat List -->
          <app-heat-list [heats]="generatedHeats"></app-heat-list>
        </div>

        <div class="action-buttons">
          <button class="btn btn-edit" (click)="updateRace()">{{ 'RM_BTN_EDIT' | translate }}</button>
          <button class="btn btn-delete" (click)="deleteRace()">{{ 'RM_BTN_DELETE_RACE' | translate }}</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Connection Lost Overlay -->
  <div class="connection-lost-overlay" *ngIf="isConnectionLost">
    <div class="connection-spinner"></div>
    <div class="connection-lost-text">{{ 'RM_LOST_CONNECTION' | translate }}</div>
  </div>

  <!-- Loading Overlay -->
  <div class="loader-overlay" *ngIf="isLoading || isSaving">
    <div class="spinner"></div>
  </div>

  <app-confirmation-modal [visible]="showDeleteConfirmation" [title]="'RM_BTN_DELETE_RACE'"
    [message]="'RM_CONFIRM_DELETE'" (confirm)="onConfirmDelete()" (cancel)="onCancelDelete()">
  </app-confirmation-modal>
</div>