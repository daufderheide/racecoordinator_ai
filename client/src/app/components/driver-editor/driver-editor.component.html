<div class="dm-container" [style.transform]="'translate(-50%, -50%) scale(' + scale + ')'"
  (dragover)="onDragOver($event)">
  <!-- Header -->
  <div class="dm-header">
    <app-back-button [label]="'DE_BTN_BACK' | translate" route="/driver-manager"
      [queryParams]="{ id: editingDriver?.entity_id }"></app-back-button>
  </div>

  <div class="content-area editor-centered" *ngIf="!isLoading">
    <!-- ONLY CONFIGURATION PANELS NOW -->
    <div class="config-panels" *ngIf="editingDriver">
      <!-- DRIVER CONFIG -->
      <div class="panel config-panel">
        <div class="panel-header">{{ 'DE_HEADER_DRIVER_CONFIG' | translate }}</div>
        <div class="config-content driver-config-layout">
          <div class="inputs-column">
            <div class="form-group">
              <label>{{ 'RDS_LABEL_NAME' | translate }}</label>
              <input type="text" [(ngModel)]="editingDriver.name" class="dm-input">
            </div>
            <div class="form-group">
              <label>{{ 'RDS_LABEL_NICKNAME' | translate }}</label>
              <input type="text" [(ngModel)]="editingDriver.nickname" class="dm-input">
            </div>
          </div>
          <div class="avatar-column">
            <div class="avatar-preview-large" (drop)="onDrop($event, 'avatar')" (dragover)="onDragOver($event)"
              (click)="openAvatarSelector()">
              <img [src]="pendingAvatarPreview || (editingDriver.avatarUrl | avatarUrl)" alt="Avatar Large">
              <div class="drop-hint" *ngIf="!editingDriver.avatarUrl && !pendingAvatarPreview">{{ 'DE_HINT_DRAG_IMAGE' |
                translate }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- AUDIO CONFIG -->
      <div class="panel audio-panel">
        <div class="panel-header">{{ 'DE_HEADER_AUDIO_CONFIG' | translate }}</div>

        <div class="audio-section">
          <app-audio-selector [label]="'DE_LABEL_LAP_SOUNDS' | translate" [assets]="soundAssets"
            [(type)]="editingDriver.lapSoundType" [(url)]="editingDriver.lapSoundUrl"
            [(text)]="editingDriver.lapSoundText" [backButtonRoute]="'/driver-editor'"
            [backButtonQueryParams]="{ id: editingDriver.entity_id }">
          </app-audio-selector>
        </div>

        <div class="audio-section">
          <app-audio-selector [label]="'DE_LABEL_BEST_LAP_SOUNDS' | translate" [assets]="soundAssets"
            [(type)]="editingDriver.bestLapSoundType" [(url)]="editingDriver.bestLapSoundUrl"
            [(text)]="editingDriver.bestLapSoundText" [backButtonRoute]="'/driver-editor'"
            [backButtonQueryParams]="{ id: editingDriver.entity_id }">
          </app-audio-selector>
        </div>

        <div class="editor-actions">
          <button class="btn btn-update" (click)="updateDriver()">
            <span class="icon">ðŸ”„</span> {{ editingDriver.entity_id === 'new' ? ('DE_BTN_CREATE_DRIVER' | translate) :
            ('DE_BTN_UPDATE_DRIVER' | translate) }}
          </button>
          <button *ngIf="editingDriver.entity_id !== 'new'" class="btn btn-new" (click)="saveAsNew()">
            <span class="icon">ðŸ’¾</span> {{ 'DE_BTN_SAVE_AS_NEW' | translate }}
          </button>
        </div>

        <div class="more-options">
          <div class="more-btn">
            <span>{{ 'DE_BTN_MORE' | translate }}</span>
            <span class="settings-icon">âš™</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loader-overlay" *ngIf="isLoading || isSaving || isUploading">
    <div class="spinner"></div>
  </div>

  <!-- Connection Lost Overlay -->
  <div class="connection-lost-overlay" *ngIf="isConnectionLost">
    <div class="connection-spinner"></div>
    <div class="connection-lost-text">{{ 'RDS_LOST_CONNECTION' | translate }}</div>
  </div>

  <!-- Avatar Selector -->
  <app-item-selector [visible]="showAvatarSelector" [title]="'DE_TITLE_SELECT_AVATAR' | translate"
    [items]="avatarAssets" [itemType]="'image'" [backButtonRoute]="'/driver-editor'"
    [backButtonQueryParams]="{ id: editingDriver ? editingDriver.entity_id : null }" (select)="onAvatarSelected($event)"
    (close)="closeAvatarSelector()">
  </app-item-selector>
</div>